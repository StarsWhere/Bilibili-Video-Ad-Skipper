# 📺 B站视频广告跳过助手 (Bilibili Ad Skipper)

![项目Logo](https://img.picui.cn/free/2025/06/18/68524942bfc36.png )
这是一款功能强大的油猴脚本，它利用 AI 代理（Agent）智能分析 Bilibili 视频的弹幕和评论，以概率形式精准检测并自动跳过视频中内置的商业广告（恰饭）部分。

## ✨ 功能特点

-   **🤖 AI 驱动分析**：本脚本调用大语言模型（如 GPT 系列）作为智能代理，深度理解弹幕和评论的上下文语境，而非简单的关键词匹配，实现更精准的广告识别。
-   **🎯 多维度检测**：同时分析**海量弹幕**和**置顶评论**，结合两种信息源，大幅提升广告识别的准确率，避免误判。
-   **📈 概率化结果**：AI 会给出广告的概率评估（0-100%），并根据广告时长进行智能惩罚调整，让判断更科学、更符合实际。
-   **⚙️ 高度可配置**：用户可以自由配置 API Key、API Base URL、AI 模型、自动跳过概率阈值和时长惩罚系数，满足个性化需求。
-   **🎨 友好用户界面**：
    -   **悬浮设置按钮**：方便随时调整各项参数。
    -   **清晰的 AI 分析结果弹窗**：直观展示广告概率、时间、分析依据等信息。
    -   **实时的 Toast 通知**：及时反馈脚本运行状态，让您掌握一切。
    -   **可拖拽的弹窗**：灵活调整位置，不影响正常观看体验。
-   **⚡️ 智能自动跳过**：当检测到的广告概率超过设定阈值时，脚本将在播放到广告开始时间时，自动将视频进度条跳转到广告结束时间，为您节省宝贵时间。

## 📸 效果截图


### 设置界面
用户可以轻松配置自己的 AI 服务参数。
![设置界面](https://img.picui.cn/free/2025/06/18/685249537fc62.png)

### AI 分析结果
分析完成后，脚本会以弹窗形式展示详细结果，用户可根据结果选择是否启用自动跳过。
![AI分析结果](https://img.picui.cn/free/2025/06/18/685249537ea46.png)

## 🚀 安装步骤

1.  **安装脚本管理器**
    首先，你的浏览器需要安装一个用户脚本管理器扩展。推荐使用 [**Tampermonkey**](https://www.tampermonkey.net/)。
    -   [Chrome 安装地址](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
    -   [Firefox 安装地址](https://addons.mozilla.org/en-US/firefox/addon/tampermonkey/)
    -   [Edge 安装地址](https://microsoftedge.microsoft.com/addons/detail/tampermonkey/iikmkjmpaadaobahmlepofghlfgfgbfp)

2.  **安装本脚本**
    -   点击此处安装：[Bilibili Video Ad Skipper](https://greasyfork.org/zh-CN/scripts/539827-bilibili-video-ad-skipper)
    -   或者，打开 Tampermonkey 管理面板，新建脚本，将本页面的脚本内容完整复制进去并保存。

## ️ 配置说明

本脚本**需要您提供自己的 AI 服务 API Key** 才能正常工作。

1.  打开任意一个 Bilibili 视频页面。
2.  点击页面右侧出现的**齿轮图标**⚙️ [<img src="https://img.picui.cn/free/2025/06/18/68524942bfc36.png" alt="设置图标" width="20"/>](https://img.picui.cn/free/2025/06/18/68524942bfc36.png)，打开“AI 广告跳过设置”窗口。
3.  填写以下配置项：
    -   **API Base URL**: 你的 AI 服务 API 地址。
        -   如果你使用 OpenAI 官方服务，通常是 `https://api.openai.com`。
        -   如果你使用第三方代理或自建服务，请填写对应的地址。
    -   **API Key**: 你的 API 密钥。请注意保密，不要泄露。
    -   **模型名称**: 你想使用的 AI 模型，例如 `gpt-3.5-turbo` 或 `gpt-4`。
        **注意**：推荐使用 `deepseek-V3`、`gemini-1.5-flash` 及以上模型以获得良好表现。低于此性能的模型可能因无法正确分析广告范围而无法使用。每次发送请求约消耗 2000-4000 token，响应约 100-200 token。（_OpenAI 模型数据暂未测试，如果您有相关数据，欢迎提供！_）
    -   **概率阈值 (%)**: AI 分析出的广告概率**高于**此值时，才会默认勾选“自动跳过”。默认 `70`。
    -   **时长惩罚 (%/分钟)**: AI 识别出的广告时间每增加一分钟，广告概率会降低的百分比。用于防止将过长的正常内容误判为广告。默认 `5`。
    -   **默认启用自动跳过**: 总开关。如果取消勾选，即使概率达标，也不会默认开启跳过功能。
4.  点击**保存**。配置完成后，脚本将在新打开的视频页自动运行。

### 高级设置 (Advanced Settings)

在设置界面的“高级设置”标签页中，您可以对脚本的更深层行为进行调整，以满足个性化需求：

-   **广告时长限制**：
    -   **最小广告时长 (秒)** （`minAdDuration`）：AI 识别出的广告时长若低于此值，将受到惩罚性概率降低，避免跳过过短的非广告内容。默认 `30` 秒。
    -   **最大广告时长 (秒)** （`maxAdDuration`）：AI 识别出的广告时长若高于此值，将受到惩罚性概率降低，防止将过长的正常内容误判为广告。默认 `300` 秒。

-   **💬 弹幕过滤设置**：
    -   **最大弹幕数量 (用于分析)** （`maxDanmakuCount`）：当过滤后的弹幕数量超过此值时，脚本将随机采样，只取最多此数量的弹幕进行 AI 分析，以优化性能，避免不必要的资源消耗。默认 `500` 条。
    -   **完整分析所需最小弹幕数** （`minDanmakuForFullAnalysis`）：当有效弹幕数量低于此值时，脚本可能跳过 AI 深度分析，或采用简化逻辑判断，以避免在弹幕稀少时进行无效的 AI 调用。默认 `50` 条。

-   **✅ 白名单设置**：
    -   **启用白名单 (仅分析含白名单关键词的弹幕)** （`enableWhitelist`）：开启后，AI 将只分析包含白名单中关键词的弹幕，进一步提升识别精度。默认启用。
    -   **白名单支持正则表达式** （`whitelistRegex`）：勾选后，白名单中的关键词将被视为正则表达式进行匹配，提供更灵活的匹配方式。
    -   **白名单** （`whitelist`）：您可以添加希望 AI 重点关注的弹幕关键词或正则表达式（例如：`分`, `秒`, `空降`, `指路`）。

-   **🚫 黑名单设置**：
    -   **启用黑名单 (过滤掉含黑名单关键词的弹幕)** （`enableBlacklist`）：开启后，AI 将过滤掉包含黑名单中关键词的弹幕，避免干扰判断，提升分析准确性。默认启用。
    -   **黑名单支持正则表达式** （`blacklistRegex`）：勾选后，黑名单中的关键词将被视为正则表达式进行匹配，确保精准过滤。
    -   **黑名单** （`blacklist`）：您可以添加不希望 AI 分析的弹幕关键词或正则表达式（例如：`正片`, `省流`, `总结`）。

## 💡 使用方法

1.  完成安装和配置后，打开任意一个 Bilibili 视频页面。
2.  脚本会自动在后台开始执行分析流程（获取信息 -> 获取弹幕 -> 发送给 AI）。你会看到右下角弹出系列状态提示。
3.  分析完成后，右下角会弹出**“AI 分析结果”**卡片。
4.  卡片上会清晰地展示**广告概率**、**预估的起止时间**和**AI的分析依据**。
5.  如果广告概率达到了你设定的阈值，**“自动跳过广告”**的复选框会默认勾选。
6.  当视频播放到广告开始时间时，脚本会自动帮你跳过这段内容。你也可以随时在结果卡片上手动取消勾选来禁用本次跳过。

## ⚠️ 免责声明

-   本脚本为开源的本地工具，仅供学习和技术交流使用，作者不对其造成的任何后果负责。
-   使用本脚本调用 AI 服务产生的**一切费用由用户自行承担**。
-   Bilibili 网站的结构可能随时变化，可能导致脚本部分或全部功能失效，作者会尽力维护，但不作任何保证。

## 🤝 贡献

欢迎任何形式的贡献！如果你有好的想法、建议或发现了 Bug，请随时提交 [Issues](https://github.com/StarsWhere/Bilibili-Video-Ad-Skipper/issues) 或 [Pull Requests](https://github.com/StarsWhere/Bilibili-Video-Ad-Skipper/pulls)。

## 📜 许可证

本项目基于 [MIT License](./LICENSE) 开源。